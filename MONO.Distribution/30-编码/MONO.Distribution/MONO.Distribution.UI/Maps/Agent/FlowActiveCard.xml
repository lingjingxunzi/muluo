<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="FlowActiveCard" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--实体类映射-->
  <alias>
    <typeAlias alias="FlowActiveCard" type="MONO.Distribution.Model.Agent.FlowActiveCard,MONO.Distribution.Model"/>
  </alias>

  <!--字段对应-->
  <resultMaps>
    <resultMap id="FlowActiveCardResult" class="FlowActiveCard">
      <result property="TransNo" column="TransNo"/>
      <result property="Numbers" column="Numbers"/>
      <result property="Amount" column="Amount"/>
      <result property="CreateTime" column="CreateTime"/>
      <result property="OverdueTime" column="OverdueTime"/>
      <result property="Status" column="Status"/>
      <result property="SysUserKey" column="SysUserKey"/>
      <result property="SystemFlowPacketKey" column="SystemFlowPacketKey"/>
      <result property="EnumStatus" column="Status" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="SystemFlowPackets" column="SystemFlowPacketKey" select="SelectSystemFlowPacketByKey" lazyLoad="false"/>
    </resultMap>
    <resultMap id="FlowActiveCardGiftResult" class="FlowActiveCard">
      <result property="TransNo" column="TransNo"/>
      <result property="Amount" column="Amount"/>
      <result property="Numbers" column="Numbers"/>
      <result property="OverdueTime" column="OverdueTime"/>
      <result property="CreateTime" column="CreateTime"/>
      <result property="Status" column="Status"/>
      <result property="SysUserKey" column="SysUserKey"/>
      <result property="SystemFlowPacketKey" column="SystemFlowPacketKey"/>
      <result property="EnumStatus" column="Status" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="SystemFlowPackets" column="SystemFlowPacketKey" select="SelectSystemFlowPacketByKey" lazyLoad="false"/>

    </resultMap>

    <resultMap id="FlowActiveCardForDetails" class="FlowActiveCard">
      <result property="TransNo" column="TransNo"/>
      <result property="Numbers" column="Numbers"/>
      <result property="Amount" column="Amount"/>
      <result property="OverdueTime" column="OverdueTime"/>
      <result property="CreateTime" column="CreateTime"/>
      <result property="Status" column="Status"/>
      <result property="SysUserKey" column="SysUserKey"/>
    </resultMap>
  </resultMaps>

  <!--动态sql语句-->
  <statements>
    Insert statement.
    <insert id='InsertFlowActiveCard' parameterClass='FlowActiveCard'>
      INSERT INTO FD_FlowActiveCard
      (
      TransNo,
      Amount,
      Numbers,
      CreateTime,
      OverdueTime,
      Status,
      SysUserKey,
      SystemFlowPacketKey
      )
      VALUES
      (
      #TransNo#,
      #Amount#,
      #Numbers#,
      GetDate(),
      #OverdueTime#,
      #Status#,
      #SysUserKey#,
      #SystemFlowPacketKey#
      )
    </insert>


    <update id='UpdateFlowActiveCard' parameterClass='FlowActiveCard'>
      UPDATE FD_FlowActiveCard
      SET

      <isNotEmpty prepend="  " property="Status"   > Status=#Status#</isNotEmpty>
      WHERE
      [TransNo] = #TransNo#
    </update>

    <delete id='DeleteFlowActiveCard' parameterClass='FlowActiveCard'>
      DELETE FROM FD_FlowActiveCard
      WHERE
      [TransNo] = #TransNo#
    </delete>



    <select id="SelectFlowActiveCardList" parameterClass="FlowActiveCard"   resultMap="FlowActiveCardResult">
      <![CDATA[SELECT 
         TransNo,
         Numbers,          
         Amount,         
        
         OverdueTime,
         CreateTime,         
         Status,
         SysUserKey,
         SystemFlowPacketKey
        ]]>
      <dynamic prepend="">
        <isEqual prepend="" property="IsStartPager" compareValue="true">
          FROM (SELECT ROW_NUMBER() OVER(ORDER BY CreateTime DESC) AS RowNumber,
          * FROM FD_FlowActiveCard
          WHERE 1=1
          <isNotEmpty property="TransNo" prepend="AND" >TransNo like '%'+#TransNo#+'%'</isNotEmpty>
          <isGreaterThan prepend="AND" compareValue="0" property="Numbers"> Numbers=#Numbers#</isGreaterThan>
          <isGreaterThan prepend="AND" compareValue="0"  property="Amount"> Amount=#Amount#</isGreaterThan>

          <isGreaterThan prepend="AND" property="SysUserKey" compareValue="0"> SysUserKey=#SysUserKey#</isGreaterThan>
          <isNotEmpty prepend="AND" compareValue="1" property="StartTime">
            <![CDATA[Convert(varchar(100), CreateTime,25)>= Convert(varchar(100),convert(datetime,#StartTime#),25)]]>
          </isNotEmpty>
          <isNotEmpty prepend="AND" compareValue="1" property="EndTime">
            <![CDATA[Convert(varchar(100), CreateTime,25) <= Convert(varchar(100),convert(datetime,#EndTime#),25)]]>
          </isNotEmpty>
          )T
        </isEqual>

        <isEqual prepend="" property="IsStartPager" compareValue="false">
          FROM FD_FlowActiveCard
        </isEqual>
      </dynamic>
      where 1=1
      <dynamic >
        <isNotEmpty property="TransNo" prepend="AND" >TransNo like '%'+#TransNo#+'%'</isNotEmpty>
        <isGreaterThan prepend="AND" compareValue="0" property="Numbers"> Numbers=#Numbers#</isGreaterThan>
        <isGreaterThan prepend="AND" compareValue="0"  property="Amount"> Amount=#Amount#</isGreaterThan>

        <isGreaterThan prepend="AND" property="SysUserKey" compareValue="0"> SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" compareValue="1" property="StartTime">
          <![CDATA[Convert(varchar(100), CreateTime,25)>= Convert(varchar(100),convert(datetime,#StartTime#),25)]]>
        </isNotEmpty>
        <isNotEmpty prepend="AND" compareValue="1" property="EndTime">
          <![CDATA[Convert(varchar(100), CreateTime,25) <= Convert(varchar(100),convert(datetime,#EndTime#),25)]]>
        </isNotEmpty>
        <isGreaterThan prepend="AND" property="StartRecordIndex" compareValue="0">
          <![CDATA[RowNumber>=#StartRecordIndex#]]>
        </isGreaterThan>
        <isGreaterThan prepend="AND" property="EndRecordIndex" compareValue="0">
          <![CDATA[RowNumber<=#EndRecordIndex#]]>
        </isGreaterThan>
      </dynamic>
    </select>

    <select id="SelectFlowActiveCardCount" parameterClass="FlowActiveCard" resultClass="int">
      Select count(*)
      FROM FD_FlowActiveCard buy

      WHERE 1=1
      <dynamic >
        <isNotEmpty property="TransNo" prepend="AND" >TransNo like '%'+#TransNo#+'%'</isNotEmpty>
        <isGreaterThan prepend="AND" compareValue="0" property="Numbers"> Numbers=#Numbers#</isGreaterThan>
        <isGreaterThan prepend="AND" compareValue="0"  property="Amount"> Amount=#Amount#</isGreaterThan>

        <isGreaterThan prepend="AND" property="SysUserKey" compareValue="0"> SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" compareValue="1" property="StartTime">
          <![CDATA[Convert(varchar(100), CreateTime,25)>= Convert(varchar(100),convert(datetime,#StartTime#),25)]]>
        </isNotEmpty>
        <isNotEmpty prepend="AND" compareValue="1" property="EndTime">
          <![CDATA[Convert(varchar(100), CreateTime,25) <= Convert(varchar(100),convert(datetime,#EndTime#),25)]]>
        </isNotEmpty>
      </dynamic>
    </select>


    <select id="SelectFlowActiveCardByKey" parameterClass="FlowActiveCard"  resultMap="FlowActiveCardResult">
      Select
      TransNo,
      Amount,
      Numbers,

      OverdueTime,
      CreateTime,
      Status,
      SysUserKey,
      SystemFlowPacketKey
      FROM FD_FlowActiveCard
      WHERE TransNo=#TransNo#
    </select>
    <select id="SelectFlowActiveCardByKeyForDetails" parameterClass="FlowActiveCard"  resultMap="FlowActiveCardForDetails">
      Select
      TransNo,
      Amount,
      Numbers,

      OverdueTime,
      CreateTime,
      Status,
      SysUserKey,
      SystemFlowPacketKey
      FROM FD_FlowActiveCard
      WHERE TransNo=#TransNo#
    </select>

  </statements>
</sqlMap>
