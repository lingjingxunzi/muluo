<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="SystemFlowPackets" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--实体类映射-->
  <alias>
    <typeAlias alias="SystemFlowPackets" type="MONO.Distribution.Model.Agent.SystemFlowPackets,MONO.Distribution.Model"/>
  </alias>

  <!--字段对应-->
  <resultMaps>
    <resultMap id="SystemFlowPacketsResult" class="SystemFlowPackets">
      <result property="SystemFlowPacketKey" column="SystemFlowPacketKey"/>
      <result property="SysUserKey" column="SysUserKey"/>
      <result property="FlowPacketKey" column="FlowPacketKey"/>
      <result property="DiscountKey" column="DiscountKey"/>
      <result property="Price" column="Price"/>
      <result property="Status" column="Status"/>
      <result property="FlowBaseInfo" column="FlowPacketKey" select="SelectFlowBaseInfoByKey" lazyLoad="false"/>
      <result property="Discounts" column="DiscountKey" select="SelectDiscountsByKey" lazyLoad="false"/>
    </resultMap>
    <resultMap id="SystemFlowPacketsIntanceResult" class="SystemFlowPackets">
      <result property="SystemFlowPacketKey" column="SystemFlowPacketKey"/>
      <result property="SysUserKey" column="SysUserKey"/>
      <result property="FlowPacketKey" column="FlowPacketKey"/>
      <result property="DiscountKey" column="DiscountKey"/>
      <result property="Price" column="Price"/>
      <result property="Status" column="Status"/>
      <result property="Discounts" column="DiscountKey" select="SelectDiscountsByKey" lazyLoad="false"/>
      <result property="FlowBaseInfo" column="FlowPacketKey" select="SelectFlowBaseInfoByKey" lazyLoad="false"/>
    </resultMap>
    <resultMap id="SystemFlowPacketsForFlowBaseInfo" class="SystemFlowPackets">

      <result property="FlowPacketKey" column="FlowPacketKey"/>

      <result property="FlowBaseInfo" column="FlowPacketKey" select="SelectFlowBaseInfoByKeyForShowName" lazyLoad="false"/>
    </resultMap>
  </resultMaps>



  <!--动态sql语句-->
  <statements>
    <!-- Insert statement.-->
    <insert id='InsertSystemFlowPacket' parameterClass='SystemFlowPackets'>
      INSERT INTO FD_SystemFlowPackets
      (
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status
      )
      VALUES
      (
      #SysUserKey#,
      #FlowPacketKey#,
      #DiscountKey#,
      #Price#,
      #Status#
      <selectKey property="SystemFlowPacketKey" resultClass="int" type="post"> SELECT cast(@@IDENTITY as bigint) AS id </selectKey>
      )
    </insert>


    <update id='UpdateSystemFlowPacket' parameterClass='SystemFlowPackets'>
      UPDATE FD_SystemFlowPackets
      SET SysUserKey=#SysUserKey#
      <isGreaterThan compareValue="0" prepend="," property="DiscountKey">DiscountKey=#DiscountKey#</isGreaterThan>
      <isGreaterThan compareValue="0" prepend="," property="Price">Price=#Price#</isGreaterThan>
      <isNotEmpty prepend="," property="Status" >Status=#Status#</isNotEmpty>
      WHERE
      [SystemFlowPacketKey] = #SystemFlowPacketKey#
    </update>

    <update id='UpdateSystemFlowPacketBySytemKey' parameterClass='SystemFlowPackets'>
      UPDATE FD_SystemFlowPackets
      SET  Status=#Status#
      WHERE
      [SysUserKey] = #SysUserKey#
    </update>

    <delete id='DeleteSystemFlowPacket' parameterClass='SystemFlowPackets'>
      DELETE FROM FD_SystemFlowPackets
      WHERE
      [SystemFlowPacketKey] = #SystemFlowPacketKey#
    </delete>


    <!--动态查询语句-->
    <select id="SelectSystemFlowPacketList" parameterClass="SystemFlowPackets" resultClass="SystemFlowPackets" resultMap="SystemFlowPacketsResult">
      <![CDATA[SELECT 
        SystemFlowPacketKey,
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status 
         ]]>
      <dynamic prepend="">
        <isEqual prepend="" property="IsStartPager" compareValue="true">
          FROM (SELECT ROW_NUMBER() OVER(ORDER BY SystemFlowPacketKey DESC) AS RowNumber,
          * FROM FD_SystemFlowPackets de
          WHERE 1=1
          <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> FlowPacketKey=#FlowPacketKey#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> DiscountKey=#DiscountKey#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="Price">Price=#Price#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >SysUserKey=#SysUserKey#</isGreaterThan>
          <isNotEmpty prepend="AND" property="Status">Status=#Status#</isNotEmpty>
          )T
        </isEqual>
        <isEqual prepend="" property="IsStartPager" compareValue="false">
          FROM FD_SystemFlowPackets
        </isEqual>
      </dynamic>
      where 1=1
      <dynamic >
        <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> FlowPacketKey=#FlowPacketKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> DiscountKey=#DiscountKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="Price">Price=#Price#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" property="Status">Status=#Status#</isNotEmpty>
        <isGreaterThan prepend="AND" property="StartRecordIndex" compareValue="0">
          <![CDATA[RowNumber>=#StartRecordIndex#]]>
        </isGreaterThan>
        <isGreaterThan prepend="AND" property="EndRecordIndex" compareValue="0">
          <![CDATA[RowNumber<=#EndRecordIndex#]]>
        </isGreaterThan>
      </dynamic>
    </select>


    <select id="SelectSystemFlowPacketCount" parameterClass="SystemFlowPackets" resultClass="int">
      Select count(*)
      FROM FD_SystemFlowPackets
      WHERE 1=1
      <dynamic >
        <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> FlowPacketKey=#FlowPacketKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> DiscountKey=#DiscountKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="Price">Price=#Price#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" property="Status">Status=#Status#</isNotEmpty>
      </dynamic>
    </select>

    <select id="SelectSystemFlowPacketByKey" parameterClass="SystemFlowPackets" resultMap="SystemFlowPacketsResult" >
      SELECT
      SystemFlowPacketKey,
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status
      from FD_SystemFlowPackets
      where SystemFlowPacketKey=#SystemFlowPacketKey#
    </select>
    <select id="SelectSystemFlowPacketByKeyForFlowBaseInfo" parameterClass="SystemFlowPackets" resultMap="SystemFlowPacketsForFlowBaseInfo" >
      SELECT

      FlowPacketKey

      from FD_SystemFlowPackets
      where SystemFlowPacketKey=#SystemFlowPacketKey#
    </select>

    <select id="SelectSystemFlowPacketByParentKey" parameterClass="SystemFlowPackets" resultMap="SystemFlowPacketsIntanceResult" >
      SELECT
      SystemFlowPacketKey,
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status
      from FD_SystemFlowPackets
      where SysUserKey=#SysUserKey#
    </select>

    <select id="SelectSystemFlowPacketBySystemKey" parameterClass="SystemFlowPackets" resultMap="SystemFlowPacketsIntanceResult" >
      SELECT
      SystemFlowPacketKey,
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status
      from FD_SystemFlowPackets
      where
      SysUserKey=#SysUserKey# and FlowPacketKey=#FlowPacketKey#
    </select>


    <select id="SelectSystemFlowPacketByUser" parameterClass="SystemFlowPackets" resultClass="SystemFlowPackets" resultMap="SystemFlowPacketsResult">
      <![CDATA[SELECT 
        SystemFlowPacketKey,
      SysUserKey,
      FlowPacketKey,
      DiscountKey,
      Price,
      Status 
         ]]>
      <dynamic prepend="">
        <isEqual prepend="" property="IsStartPager" compareValue="true">
          FROM (SELECT ROW_NUMBER() OVER(ORDER BY SystemFlowPacketKey DESC) AS RowNumber,
          de.*  FROM FD_SystemFlowPackets de
          left join FD_FlowBaseInfo fbi
          on fbi.FlowKey = de.FlowPacketKey
          WHERE 1=1
          <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> de.FlowPacketKey=#FlowPacketKey#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> de.DiscountKey=#DiscountKey#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="Price">de.Price=#Price#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >de.SysUserKey=#SysUserKey#</isGreaterThan>
          <isNotEmpty prepend="AND" property="Status">de.Status=#Status#</isNotEmpty>
          )T
        </isEqual>
        <isEqual prepend="" property="IsStartPager" compareValue="false">
          from (select de.*  FROM FD_SystemFlowPackets de
          left join FD_FlowBaseInfo fbi
          on fbi.FlowKey = de.FlowPacketKey
          where 1=1
          <isNotEmpty prepend="AND" property="Name">fbi.name like '%'+#Name#+'%'</isNotEmpty>
          )T
        </isEqual>
      </dynamic>
      where 1=1
      <dynamic >
        <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> FlowPacketKey=#FlowPacketKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> DiscountKey=#DiscountKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="Price">Price=#Price#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" property="Status">Status=#Status#</isNotEmpty>
        <isGreaterThan prepend="AND" property="StartRecordIndex" compareValue="0">
          <![CDATA[RowNumber>=#StartRecordIndex#]]>
        </isGreaterThan>
        <isGreaterThan prepend="AND" property="EndRecordIndex" compareValue="0">
          <![CDATA[RowNumber<=#EndRecordIndex#]]>
        </isGreaterThan>
      </dynamic>
    </select>


    <select id="SelectSystemFlowPacketCountByUser" parameterClass="SystemFlowPackets" resultClass="int">
      Select count(*)
      FROM FD_SystemFlowPackets de
      left join FD_FlowBaseInfo fbi
      on fbi.FlowKey = de.FlowPacketKey
      WHERE 1=1
      <dynamic >
        <isGreaterThan compareValue="0" prepend="AND" property="FlowPacketKey"> de.FlowPacketKey=#FlowPacketKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="DiscountKey"> de.DiscountKey=#DiscountKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="Price">de.Price=#Price#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="SysUserKey" >de.SysUserKey=#SysUserKey#</isGreaterThan>
        <isNotEmpty prepend="AND" property="Status">de.Status=#Status#</isNotEmpty>
        <isNotEmpty prepend="AND" property="Name">fbi.name like '%'+#Name#+'%'</isNotEmpty>
      </dynamic>
    </select>


  </statements>
</sqlMap>
