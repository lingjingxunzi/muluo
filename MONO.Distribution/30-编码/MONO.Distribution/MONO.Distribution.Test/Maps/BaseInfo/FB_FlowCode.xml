<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="FlowCode" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!--实体类映射-->
  <alias>
    <typeAlias alias="FlowCode" type="MONO.Distribution.Model.BaseInfo.FlowCode,MONO.Distribution.Model"/>
  </alias>

  <!--字段对应-->
  <resultMaps>
    <resultMap id="FlowCodeResult" class="FlowCode">
      <result property="FlowCodeKey" column="FlowCodeKey"/>
      <result property="FlowKey" column="FlowKey"/>
      <result property="From" column="From"/>
      <result property="Carrier" column="Carrier"/>
      <result property="ProductCode" column="ProductCode"/>
      <result property="Area" column="Area"/>
      <result property="Priority" column="Priority"/>
      <result property="Status" column="Status"/>
      <result property="DiscountKey" column="DiscountKey"/>
      <result property="PurchasePrice" column="PurchasePrice"/>
      <result property="FromRanges" column="FromRanges"/>
      <result property="Name" column="Name"/>
      <result property="Discounts" column="DiscountKey" select="SelectDiscountsByKey" lazyLoad="false"/>
      <result property="EnumCarrier" column="Carrier" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="EnumFrom" column="From" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="EnumFromRanges" column="FromRanges" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="AreaName" column="Area" select="SelectAreaByKey" lazyLoad="false"/>
      <result property="FlowBaseInfo" column="FlowKey" select="SelectFlowBaseInfoByKey" lazyLoad="false"/>
    </resultMap>

    <resultMap id="FlowCodeResul_Instance" class="FlowCode">
      <result property="FlowCodeKey" column="FlowCodeKey"/>
      <result property="FlowKey" column="FlowKey"/>
      <result property="From" column="From"/>
      <result property="Carrier" column="Carrier"/>
      <result property="ProductCode" column="ProductCode"/>
      <result property="Area" column="Area"/>
      <result property="Priority" column="Priority"/>
      <result property="Status" column="Status"/>
      <result property="DiscountKey" column="DiscountKey"/>
      <result property="PurchasePrice" column="PurchasePrice"/>
      <result property="FromRanges" column="FromRanges"/>
      <result property="Name" column="Name"/>
      <result property="Discounts" column="DiscountKey" select="SelectDiscountsByKey" lazyLoad="false"/>
      <result property="EnumCarrier" column="Carrier" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="EnumFrom" column="From" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="AreaName" column="Area" select="SelectAreaByKey" lazyLoad="false"/>
      <result property="EnumFromRanges" column="FromRanges" select="SelectEnumerationByKey" lazyLoad="false"/>

    </resultMap>


    <resultMap id="FlowCodeResul_Info" class="FlowCode">
      <result property="From" column="From"/>
      <result property="Carrier" column="Carrier"/>
      <result property="Area" column="Area"/>
      <result property="Status" column="Status"/>
      <result property="DiscountKey" column="DiscountKey"/>
      <result property="FromRanges" column="FromRanges"/>
      <result property="Name" column="Name"/>
      <result property="EnumCarrier" column="Carrier" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="EnumFrom" column="From" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="AreaName" column="Area" select="SelectAreaByKey" lazyLoad="false"/>
      <result property="EnumFromRanges" column="FromRanges" select="SelectEnumerationByKey" lazyLoad="false"/>
      <result property="Discounts" column="DiscountKey" select="SelectDiscountsByKey" lazyLoad="false"/>

    </resultMap>

    <resultMap id="FlowCodeGetResult" class="FlowCode">
      <result property="Carrier" column="Carrier"/>
      <result property="ProductCode" column="ProductCode"/>
      <result property="Priority" column="Priority"/>
    </resultMap>

  </resultMaps>

  <!--动态sql语句-->
  <statements>

    <!-- Insert statement.-->
    <insert id='InsertFlowCode' parameterClass='FlowCode'>
      INSERT INTO FD_FlowCode
      (
      FlowKey,
      [From],
      Carrier,
      ProductCode,
      [Area],
      [Priority],
      Status,
      DiscountKey,
      PurchasePrice,
      FromRanges,
      Name
      )
      VALUES
      (
      #FlowKey#,
      #From#,
      #Carrier#,
      #ProductCode#,
      #Area#,
      #Priority#,
      #Status#,
      #DiscountKey#,
      #PurchasePrice#,
      #FromRanges#,
      #Name#
      <selectKey property="FlowCodeKey" resultClass="int" type="post"> SELECT cast(@@IDENTITY as int) AS id </selectKey>
      )
    </insert>

    <update id='UpdateFlowCode' parameterClass='FlowCode'>
      UPDATE FD_FlowCode
      SET
      <isGreaterThan prepend=" " compareValue="0" property="FlowKey">FlowKey=#FlowKey#</isGreaterThan>
      <isNotEmpty prepend="," property="From">[From]=#From#</isNotEmpty>
      <isNotEmpty prepend="," property="ProductCode">ProductCode=#ProductCode#</isNotEmpty>
      <isNotEmpty prepend="," property="Area">Area=#Area#</isNotEmpty>
      <isNotEmpty prepend="," property="Status">Status=#Status#</isNotEmpty>
      <isNotEmpty prepend="," property="Carrier">Carrier=#Carrier#</isNotEmpty>
      <isNotEmpty prepend="," property="PurchasePrice">PurchasePrice=#PurchasePrice#</isNotEmpty>
      <isGreaterThan prepend="," compareValue="0" property="Priority" >[Priority]=#Priority#</isGreaterThan>
      <isNotEmpty prepend="," property="Name">Name=#Name#</isNotEmpty>
      <isGreaterThan prepend="," compareValue="0" property="DiscountKey">DiscountKey=#DiscountKey#</isGreaterThan>
      WHERE
      [FlowCodeKey] = #FlowCodeKey#
    </update>

    <delete id='DeleteFlowCode  ' parameterClass='FlowCode'>
      DELETE FROM FD_FlowCode
      WHERE
      [FlowCodeKey] = #FlowCodeKey#
    </delete>

    <!--动态查询语句-->
    <select id="SelectFlowCodeList" parameterClass="FlowCode"   resultMap="FlowCodeResult">
      <![CDATA[SELECT 
         FlowCodeKey,
         FlowKey,
         [From] ,
         Carrier,
         ProductCode,
        [Area],
        [Priority],       
        [Status] ,
        DiscountKey,
        PurchasePrice,
        FromRanges,
        Name
         ]]>
      <dynamic prepend="">
        <isEqual prepend="" property="IsStartPager" compareValue="true">
          FROM (SELECT ROW_NUMBER() OVER(ORDER BY Priority ) AS RowNumber,*
          FROM FD_FlowCode
          WHERE status='Y'
          <isGreaterThan compareValue="0" prepend="AND" property="FlowKey">FlowKey=#FlowKey#</isGreaterThan>
          <isGreaterThan compareValue="0" prepend="AND" property="FlowCodeKey">FlowCodeKey=#FlowCodeKey#</isGreaterThan>
          <isNotEmpty property="Area" prepend="AND" >Area=#Area#</isNotEmpty>
          <isNotEmpty   prepend="AND" property="Carrier">Carrier=#Carrier#</isNotEmpty>
          <isNotEmpty prepend="AND" property="From">[From]=#From#</isNotEmpty>
          <isNotNull prepend="" property="AreaStr" >
            <iterate prepend="AND" property="AreaStr"
  open="(" close=")" conjunction="OR">
              Area=#AreaStr[]#
            </iterate>
          </isNotNull>
          <isNotNull prepend="" property="FlowKeyListForQuery" >
            <iterate prepend="AND" property="FlowKeyListForQuery"
        open="(" close=")" conjunction="OR">
              FlowKey=#FlowKeyListForQuery[]#
            </iterate>
          </isNotNull>
          )T
        </isEqual>
        <isEqual prepend="" property="IsStartPager" compareValue="false">
          FROM FD_FlowCode
        </isEqual>
      </dynamic>
      where status='Y'
      <dynamic >
        <isGreaterThan compareValue="0" prepend="AND" property="FlowKey">FlowKey=#FlowKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="FlowCodeKey">FlowCodeKey=#FlowCodeKey#</isGreaterThan>
        <isNotEmpty property="Area" prepend="AND" >Area=#Area#</isNotEmpty>
        <isNotEmpty   prepend="AND" property="Carrier">Carrier=#Carrier#</isNotEmpty>
        <isNotEmpty prepend="AND" property="From">[From]=#From#</isNotEmpty>
        <isNotNull prepend="" property="AreaStr" >
          <iterate prepend="AND" property="AreaStr"
open="(" close=")" conjunction="OR">
            Area=#AreaStr[]#
          </iterate>
        </isNotNull>
        <isNotNull prepend="" property="FlowKeyListForQuery" >
          <iterate prepend="AND" property="FlowKeyListForQuery"
      open="(" close=")" conjunction="OR">
            FlowKey=#FlowKeyListForQuery[]#
          </iterate>
        </isNotNull>
        <isGreaterThan prepend="AND" property="StartRecordIndex" compareValue="0">
          <![CDATA[RowNumber>=#StartRecordIndex#]]>
        </isGreaterThan>
        <isGreaterThan prepend="AND" property="EndRecordIndex" compareValue="0">
          <![CDATA[RowNumber<=#EndRecordIndex#]]>
        </isGreaterThan>
      </dynamic>
      order by Priority
    </select>

    <select id="SelectFlowCodeCount" parameterClass="FlowCode" resultClass="int">
      Select count(*)
      FROM FD_FlowCode
      WHERE status='Y'
      <dynamic>
        <isGreaterThan compareValue="0" prepend="AND" property="FlowKey">FlowKey=#FlowKey#</isGreaterThan>
        <isGreaterThan compareValue="0" prepend="AND" property="FlowCodeKey">FlowCodeKey=#FlowCodeKey#</isGreaterThan>
        <isNotEmpty property="Area" prepend="AND" >Area=#Area#</isNotEmpty>
        <isNotEmpty prepend="AND" property="Carrier">Carrier=#Carrier#</isNotEmpty>
        <isNotEmpty prepend="AND" property="From">[From]=#From#</isNotEmpty>
        <isNotNull prepend="" property="FlowKeyListForQuery" >
          <iterate prepend="AND" property="FlowKeyListForQuery"
      open="(" close=")" conjunction="OR">
            FlowKey=#FlowKeyListForQuery[]#
          </iterate>
        </isNotNull>
        <isNotNull prepend="" property="AreaStr" >
          <iterate prepend="AND" property="AreaStr"
open="(" close=")" conjunction="OR">
            Area=#AreaStr[]#
          </iterate>
        </isNotNull>
      </dynamic>
    </select>

    <select id='SelectFlowCodeByKey' resultMap='FlowCodeResult' parameterClass='FlowCode'>
      SELECT
      FlowCodeKey,
      FlowKey,
      [From],
      Carrier,
      ProductCode,
      [Area],
      [Priority],
      [Status],
      DiscountKey,
      PurchasePrice,
      FromRanges,
      Name
      FROM FD_FlowCode
      WHERE
      [FlowCodeKey] = #FlowCodeKey#
    </select>
    <select id='SelectFlowCodeByKeyForParent' resultMap='FlowCodeResul_Instance' parameterClass='FlowCode'>
      SELECT
      FlowCodeKey,
      FlowKey,
      [From],
      Carrier,
      ProductCode,
      [Area],
      [Priority],
      [Status],
      DiscountKey,
      PurchasePrice,
      FromRanges,
      Name
      FROM FD_FlowCode
      WHERE
      [FlowKey] = #FlowKey#
    </select>

    <select  id='SelectFlowCodeByCarrier' resultMap='FlowCodeResul_Info' parameterClass='string'>
      select distinct * from (
      select [from], carrier, Area,DiscountKey,fromranges  ,Status,Name
      from FD_FlowCode fc
      )T
      where carrier=#value#
      order by Area
    </select>


    <select  id='SelectFlowCodeByDistinctList' resultMap='FlowCodeResul_Info' parameterClass='FlowCode'>
      select distinct * from (
      select [from], carrier, Area,DiscountKey,fromranges  ,Status,Name
      from FD_FlowCode fc
      )T
      order by Area
    </select>

    <select  id='SelectFlowCodeByDistinctCount' resultClass='int' parameterClass='FlowCode'>
      select count(*) from (
      select distinct * from (
      select [from], carrier, Area,DiscountKey,fromranges  ,Status,Name
      from FD_FlowCode fc
      )T
      )T2
    </select>
  </statements>
</sqlMap>
